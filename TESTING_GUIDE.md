# 内购功能测试指南

## 🚨 重要：模拟器限制

iOS模拟器**不支持**真实的App Store购买，包括沙盒购买。这是Apple的系统限制。

## 📱 真实设备测试步骤

### 1. **准备测试设备**
- 使用真实的iPhone/iPad设备
- 确保设备已登录Apple ID
- 确保网络连接正常

### 2. **创建沙盒测试账户**
1. 访问 https://appstoreconnect.apple.com
2. 进入"用户和访问" → "沙盒测试员"
3. 点击"+"创建新的沙盒测试员
4. 填写邮箱和密码（不要使用真实Apple ID）
5. 选择地区（建议选择中国）

### 3. **在设备上登录沙盒账户**
1. 在测试设备上打开"设置"
2. 点击顶部的Apple ID
3. 选择"退出登录"
4. 重新登录时使用沙盒测试账户
5. 系统会提示这是沙盒环境

### 4. **测试购买流程**
1. 运行应用：`flutter run --debug`
2. 进入内购页面
3. 尝试购买产品
4. 验证购买状态更新

## 🔧 调试信息解读

### 当前状态分析：
```
flutter: Trial Product: 14天试用
flutter: Full Version Product: 完整版本
```
✅ **产品信息已成功获取** - 说明App Store Connect配置正确

```
flutter: Error purchasing trial: PlatformException(storekit2_failed_to_fetch_product)
```
❌ **购买失败** - 在模拟器中这是正常的

## 📋 测试检查清单

### 在真实设备上测试：
- [ ] 设备已登录沙盒测试账户
- [ ] 网络连接正常
- [ ] 应用能正常启动
- [ ] 内购页面能正常显示
- [ ] 购买按钮能正常点击
- [ ] 购买流程能正常进行
- [ ] 购买状态能正确更新

## 🚀 快速测试命令

```bash
# 在真实设备上运行
flutter run --debug

# 查看详细日志
flutter logs
```

## ⚠️ 注意事项

1. **沙盒环境**：
   - 沙盒购买不会产生真实费用
   - 购买状态仅在沙盒环境中有效
   - 每次应用重新安装会重置购买状态

2. **测试账户**：
   - 不要使用真实的Apple ID进行沙盒测试
   - 沙盒账户仅在测试环境中有效
   - 可以创建多个沙盒账户测试不同场景

3. **产品同步**：
   - App Store Connect的产品配置需要时间同步
   - 如果产品查询失败，等待几分钟后重试

## 🆘 常见问题

### Q: 为什么在模拟器中无法购买？
A: iOS模拟器不支持真实的App Store购买，这是Apple的限制。

### Q: 沙盒购买会扣费吗？
A: 不会，沙盒购买是免费的测试环境。

### Q: 产品信息获取成功但购买失败？
A: 这通常是因为在模拟器中测试，在真实设备上应该能正常工作。

---

**总结**：你的内购配置是正确的，只需要在真实设备上测试即可！ 